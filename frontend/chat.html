<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chat</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<style>
#chat-box {height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;}
</style>
</head>
<body class="container mt-4">
<h3>Chat</h3>
<div id="chat-box"></div>
<form id="chatForm" class="mt-3">
  <input type="text" id="message" class="form-control" placeholder="Type your message">
</form>

<script>
const receiverId = new URLSearchParams(window.location.search).get('to');

function loadChat(){
    $.post('../backend/chat.php',{action:'fetch',receiver_id:receiverId},function(data){
        const msgs = JSON.parse(data);
        let html='';
        msgs.forEach(m=>{
            html += `<div><b>${m.sender_name}:</b> ${m.message}</div>`;
        });
        $('#chat-box').html(html);
        $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
    });
}
setInterval(loadChat,2000);
loadChat();

$('#chatForm').on('submit',function(e){
    e.preventDefault();
    const msg=$('#message').val();
    $.post('../backend/chat.php',{action:'send',receiver_id:receiverId,message:msg},function(data){
        $('#message').val('');
        loadChat();
    });
});
</script>
</body>
</html>
